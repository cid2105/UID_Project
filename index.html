<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Good Eats</title>
        <link rel="shortcut icon" href="favicon.png" />
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="css/extruder.css">
        <link rel="stylesheet" href="css/base.css">
        <link rel="stylesheet" href="css/isotope.css">
        <script src="js/jquery-1.8.2.min.js" type="text/javascript"></script>
        <script src="js/jquery-ui.js" type="text/javascript"></script>
        <script src="js/bootstrap.min.js" type="text/javascript"></script>
        <script src="js/extruder.js" type="text/javascript"></script>
        <script src="js/filer.js" type="text/javascript"></script>
        <script type="text/javascript" src="js/bootbox.min.js"></script>
        <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/oauth.js"></script>
        <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/sha1.js"></script>
        <script type="text/javascript" src="http://api.maps.nokia.com/2.2.1/jsl.js?with=all" charset="utf-8"></script>
        <script type="text/javascript" src="js/yelp_search.js"></script>
        <script type="text/javascript" src="js/geo.js"></script>
        <script type="text/javascript" src="js/noty.js"></script>
        <script type="text/javascript" src="js/isotope.js"></script>
        <script type="text/javascript" src="js/default.js"></script>
    </head>
    <body>


        <div id="extruderRight" class="a {title:'Results...', url:'extruderRight.html'}"></div>

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">

                    <a style="color:#0088CC;" class="brand" href="/">Good <span style="color: #06f;">Eats</span></a>
                    <div class="nav-collapse collapse">


                        <form class="navbar-search pull-right">
                            <div class="input-append">
                                <a href="#" class="btn btn-info btn-small" style="padding: 7px; margin-left: 7px; position:relative; right: 8px;" rel="tooltip" title="Use my current location"><i class="icon-white icon-screenshot" id="locale_button"></i></a>
                                <input type="text" class="search-query span3 zip-search" id="locale" placeholder="Enter Zipcode or City..." style="margin-right: 7px;">
                                <span style="color: #06f; font-size: 20px; padding: 10px 3px; position:relative; top: 3px;">&</span>
                                <input type="text" id="query" class="search-query span3" placeholder="Enter terms, Ex: food or italian" style="margin-left: 7px; margin-right: 20px;">
                                <button type="submit" class="btn btn-primary" id="search">Search Yelp</button>
                            </div>
                        </form>

                        <ul class="nav pull-right">
                            <li class="dropdown">
                                <a data-toggle="dropdown" class="dropdown-toggle" href="#">Sort <b class="caret"></b></a>
                                <ul class="dropdown-menu option-set" id="sort-by" data-option-key="sortBy">
                                  <li><a href="#sortBy=name" data-option-value="name">Name</a></li>
                                  <li><a href="#sortBy=rating" data-option-value="rating">Rating</a></li>
                                  <li><a href="#sortBy=popularity" data-option-value="popularity">Popularity</a></li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a data-toggle="dropdown" class="dropdown-toggle" href="#">Filter <b class="caret"></b></a>
                                <ul class="dropdown-menu option-set" id="filter-by" data-option-key="sortBy">
                                    <li><a href="#" data-filter="*">Show All</a></li>
                                    <li><a href="#" id="greenFilter" data-filter=".green">Green Label</a></li>
                                    <li><a href="#" id="orangeFilter" data-filter=".orange">Orange Label</a></li>
                                    <li><a href="#" id="purpleFilter" data-filter=".purple">Purple Label</a></li>
                                    <li><a href="#" id="redFilter" data-filter=".red">Red Label</a></li>
                                    <li><a href="#" id="blueFilter" data-filter=".blue">Blue Label</a></li>
                                </ul>
                            </li>
                            <li class="divider-vertical"></li>
                        </ul>

                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>
        <div id="content" style="z-index:999;" droppable>
            <div style="padding:73px 40px 40px 40px; height:500px;">

                    <div class="bs-docs-example bs-docs-example-popover" id="isotope_container">
                        <div class="isotope">
                        </div>


                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            $("#extruderRight").buildMbExtruder({

                        position:"right",
                        width:350,
                        extruderOpacity:.8,

                        hidePanelsOnClose:true,
                        accordionPanels:false,
                        onExtOpen:function(){},
                        onExtContentLoad:function(){$("#extruderRight").openPanel();},
                        onExtClose:function(){}
                    });


            $(function() {
                var draggableArguments={ helper:'clone', appendTo: '#content', containment: 'DOM', snap: true, zIndex: 1500, addClasses: true, start:function(event, ui) { globalElement = $(this); }, stop:function(event, ui) { globalElement = null; } };
                $("[draggable]").draggable(draggableArguments);
                $( "[droppable]" ).droppable({
                    accept: "[draggable]",
                    activeClass: "ui-state-hover",
                    hoverClass: "ui-state-active",
                    drop: function( event, ui ) {
                        ui.helper.fadeOut();
                        var elem = globalElement.detach().draggable( "disable" );
                        var yelp_id = $(elem).attr("yelpid");
                        if (!isPinned(yelp_id)) {
                            var pinID = parseInt($(elem).attr("searchind"));
                            var mapUnique = $(elem).attr("mapid");
                            var lat = parseFloat($(elem).attr("lat"));
                            var lon = parseFloat($(elem).attr("lon"));
                            var pinindex = pin(pinID, mapUnique, lat, lon);
                            //Todo Check if already pinned before pinning
                            $(".isotope").isotope( 'insert', elem);
                            $(elem).find(".pin-hidden").removeClass("pin-hidden");
                            var n = noty({ text: "Bookmark added successfully", type: 'information', layout: 'bottom', theme: 'defaultTheme'});
                            $(elem).find(".pin-out").removeClass( "pin-out", 2000);
                            var pinindex = $(elem).attr("pinindex", pinindex);

                            setTimeout(function(){n.close(); }, 3000);
                        }
                        else {
                            bootbox.dialog("This business card had already been pinned.", [{
                                "label" : "OK",
                                "class" : "btn-primary",
                            }]);
                        }
                    }
                });
            });


            var geocoder;

            $("#locale_button").click(function(){
                if (navigator.geolocation ) {
                    initialize();
                    navigator.geolocation.getCurrentPosition(successFunction, handle_errors);
                }
                else
                    yqlgeo.get('visitor', normalize_yql_response);
            });

            $(function(){
                var $container = $('.isotope');
                $container.isotope({
                    itemSelector : '.card',
                    getSortData : {
                        rating : function( $elem ) {
                            return parseFloat($elem.attr('rating'));
                        },
                        popularity : function( $elem ) {
                            return parseInt($elem.attr('popularity'));
                        },
                        name : function ( $elem ) {
                            return $elem.attr('name');
                        }
                    }
                });

                // filter items when filter link is clicked
                $('#filter-by a').click(function(){
                  var selector = $(this).attr('data-filter');
                  $container.isotope({ filter: selector });
                  return false;
                });

                var $optionSets = $('.option-set'),
                  $optionLinks = $optionSets.find('a');

                $optionLinks.click(function(){
                    var $this = $(this);
                    // don't proceed if already selected
                    if ( $this.hasClass('selected') ) {
                        return false;
                    }

                    var $optionSet = $this.parents('.option-set');
                    $optionSet.find('.selected').removeClass('selected');
                    $this.addClass('selected');

                    if( $this.find("input[type='checkbox']") )
                        $this.find("input[type='checkbox'] :first").attr("checked", "1");

                    sortAscending = false;
                    if( $this.attr('data-option-value') == "name" )
                        sortAscending = true;
                    // make option object dynamically, i.e. { filter: '.my-filter-class' }
                    var options = {'sortAscending' : sortAscending},
                        key = $optionSet.attr('data-option-key'),
                        value = $this.attr('data-option-value');
                    // parse 'false' as false boolean
                    value = value === 'false' ? false : value;
                    options[ key ] = value;
                    if ( key === 'layoutMode' && typeof changeLayoutMode === 'function' ) {
                        // changes in layout modes need extra logic
                        changeLayoutMode( $this, options )
                    } else {
                        // otherwise, apply new options
                        $container.isotope( options );
                    }

                    return false;
                });
            });
        </script>
    </body>
</html>